{% extends "base.html" %}

{% block title %}Plato - Course Outline to Calendar{% endblock %}

{% block body_class %}landing-page-body{% endblock %}
{% block container_class %}landing-page-container{% endblock %}
{% block main_class %}landing-page{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <!-- Background Calendar Animation -->
    <div class="calendar-background">
        <div class="calendar-grid">
            {% for day in range(1, 36) %}
            <div class="calendar-day">
                <div class="calendar-day-inner">
                    <div class="calendar-day-number">{{ day }}</div>
                    {% if day in [2, 4, 9, 11, 16, 18, 23, 25] %}
                    <div class="calendar-event" data-day="{{ day }}">
                        {% if day == 2 %}Lecture 1
                        {% elif day == 4 %}Assignment 1
                        {% elif day == 9 %}Lab 1
                        {% elif day == 11 %}Lecture 2
                        {% elif day == 16 %}Assignment 2
                        {% elif day == 18 %}Lab 2
                        {% elif day == 23 %}Midterm
                        {% elif day == 25 %}Lecture 3
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="hero-content">
        <div class="hero-card">
            <div class="hero-badge">
                <i data-lucide="calendar-check"></i>
                <span>Automatic Course Calendar Generation</span>
            </div>
            
            <h1 class="hero-title">From Course Outline to Calendar in Seconds</h1>
            
            <p class="hero-description">
                Upload your course outline and instantly generate a calendar file with all assignments, 
                lectures, labs, and due dates automatically extracted.
            </p>
            
            <button class="btn-hero" onclick="document.getElementById('upload-section').scrollIntoView({ behavior: 'smooth' })">
                <i data-lucide="upload"></i>
                Get Started
            </button>
        </div>
    </div>
    
    <div class="hero-glow"></div>
</section>

<!-- How It Works Section -->
<section class="how-it-works-section">
    <div class="how-it-works-container">
        <h2 class="section-title">How It Works</h2>
        
        <!-- Animated Workflow Visualization -->
        <div class="workflow-visualization">
            <!-- Document Icon -->
            <div class="workflow-step" data-step="1">
                <div class="workflow-icon">
                    <i data-lucide="file-text"></i>
                </div>
                <span class="workflow-label">Course Outline</span>
            </div>

            <!-- Arrow 1 -->
            <div class="workflow-arrow" data-arrow="1">
                <div class="arrow-line"></div>
                <div class="arrow-particle"></div>
            </div>

            <!-- Processing Icon -->
            <div class="workflow-step" data-step="2">
                <div class="workflow-icon processing">
                    <i data-lucide="zap"></i>
                </div>
                <span class="workflow-label">Processing</span>
            </div>

            <!-- Arrow 2 -->
            <div class="workflow-arrow" data-arrow="2">
                <div class="arrow-line"></div>
                <div class="arrow-particle"></div>
            </div>

            <!-- Calendar Icon -->
            <div class="workflow-step" data-step="3">
                <div class="workflow-icon">
                    <i data-lucide="calendar"></i>
                </div>
                <span class="workflow-label">Calendar File</span>
            </div>
        </div>
        
        <div class="features-grid">
            <div class="feature-item">
                <div class="feature-icon">
                    <i data-lucide="file-text"></i>
                </div>
                <div class="feature-text-wrapper">
                    <h3 class="feature-title">Upload Course Outline</h3>
                    <p class="feature-description">Support for PDF, DOCX, and TXT formats</p>
                </div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">
                    <i data-lucide="zap"></i>
                </div>
                <div class="feature-text-wrapper">
                    <h3 class="feature-title">Automatic Extraction</h3>
                    <p class="feature-description">AI-powered parsing of assignments, lectures, and labs</p>
                </div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">
                    <i data-lucide="calendar"></i>
                </div>
                <div class="feature-text-wrapper">
                    <h3 class="feature-title">Calendar Export</h3>
                    <p class="feature-description">Download .ics file compatible with all calendar apps</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Upload Section -->
<section id="upload-section" class="upload-section-new">
    <div class="upload-container">
        <h2 class="section-title">Upload Your Course Outline</h2>
        
        <form action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data" class="upload-form-new" id="upload-form">
            <div class="upload-dropzone" id="upload-dropzone">
                <input
                    type="file"
                    id="pdf_file"
                    name="pdf_file"
                    accept=".pdf"
                    required
                    class="file-input-hidden"
                />
                
                <div class="upload-content" id="upload-content">
                    <i data-lucide="upload" class="upload-icon"></i>
                    <p class="upload-text">Drag and drop your course outline here</p>
                    <p class="upload-or">or</p>
                    <label for="pdf_file" class="upload-browse-btn">
                        Browse Files
                    </label>
                    <p class="upload-hint">Supports PDF files</p>
                </div>
                
                <div class="upload-file-info" id="upload-file-info" style="display: none;">
                    <i data-lucide="file-text" class="file-icon"></i>
                    <div class="file-details">
                        <p class="file-name" id="file-name-display"></p>
                        <p class="file-size" id="file-size-display"></p>
                    </div>
                </div>
            </div>

            <input type="hidden" name="force_refresh" value="">

            <div class="upload-actions" id="upload-actions" style="display: none;">
                <button type="button" class="btn-remove-file" id="btn-remove-file">
                    Remove File
                </button>
                <button type="submit" class="btn-generate">
                    <i data-lucide="download"></i>
                    Generate Calendar
                </button>
            </div>
        </form>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    // Initialize Lucide icons
    lucide.createIcons();
    
    // File upload handling
    const fileInput = document.getElementById('pdf_file');
    const dropzone = document.getElementById('upload-dropzone');
    const uploadContent = document.getElementById('upload-content');
    const uploadFileInfo = document.getElementById('upload-file-info');
    const uploadActions = document.getElementById('upload-actions');
    const fileNameDisplay = document.getElementById('file-name-display');
    const fileSizeDisplay = document.getElementById('file-size-display');
    const btnRemoveFile = document.getElementById('btn-remove-file');
    
    let isDragging = false;
    
    // Drag and drop handlers
    dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        isDragging = true;
        dropzone.classList.add('dragging');
    });
    
    dropzone.addEventListener('dragleave', () => {
        isDragging = false;
        dropzone.classList.remove('dragging');
    });
    
    dropzone.addEventListener('drop', (e) => {
        e.preventDefault();
        isDragging = false;
        dropzone.classList.remove('dragging');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFileSelect(files[0]);
        }
    });
    
    // File input change
    fileInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
        }
    });
    
    // Handle file selection
    function handleFileSelect(file) {
        if (file && file.type === 'application/pdf') {
            fileInput.files = new DataTransfer().files; // Clear first
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            fileInput.files = dataTransfer.files;
            
            // Update UI
            fileNameDisplay.textContent = file.name;
            fileSizeDisplay.textContent = (file.size / 1024).toFixed(1) + ' KB';
            
            uploadContent.style.display = 'none';
            uploadFileInfo.style.display = 'flex';
            uploadActions.style.display = 'flex';
            
            lucide.createIcons();
        } else {
            alert('Please select a PDF file.');
        }
    }
    
    // Remove file
    btnRemoveFile.addEventListener('click', () => {
        fileInput.value = '';
        uploadContent.style.display = 'block';
        uploadFileInfo.style.display = 'none';
        uploadActions.style.display = 'none';
    });
    
    // Calendar animation - matching Figma timing
    document.addEventListener('DOMContentLoaded', () => {
        const events = document.querySelectorAll('.calendar-event');
        const isMobile = window.innerWidth <= 768;
        
        // Figma timing: 5s duration, 3s repeatDelay, delays: 0, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1
        const delays = [0, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1];
        
        events.forEach((event, index) => {
            setTimeout(() => {
                // Use shorter animation on mobile for better performance
                const duration = isMobile ? '3s' : '5s';
                const repeatDelay = isMobile ? '2s' : '3s';
                event.style.animation = `calendarPulse ${duration} ${repeatDelay} infinite`;
                event.style.animationDelay = (delays[index] || index * 0.3) + 's';
            }, 100);
        });
        
        // Re-initialize on resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const newIsMobile = window.innerWidth <= 768;
                events.forEach((event, index) => {
                    const duration = newIsMobile ? '3s' : '5s';
                    const repeatDelay = newIsMobile ? '2s' : '3s';
                    event.style.animation = `calendarPulse ${duration} ${repeatDelay} infinite`;
                    event.style.animationDelay = (delays[index] || index * 0.3) + 's';
                });
            }, 250);
        });
    });
    
    // Workflow animation - matching Figma timing (7s cycle)
    document.addEventListener('DOMContentLoaded', () => {
        const steps = document.querySelectorAll('.workflow-step');
        const arrows = document.querySelectorAll('.workflow-arrow');
        const isMobile = window.innerWidth <= 768;
        
        // On mobile, show all steps immediately (no animation needed)
        if (isMobile) {
            steps.forEach(step => {
                step.classList.add('active');
            });
            arrows.forEach(arrow => {
                arrow.classList.add('active');
            });
            return;
        }
        
        // Figma timing: 7s cycle - animations are now handled by CSS keyframes
        // Just add 'active' class to trigger animations
        function animateWorkflow() {
            steps.forEach(step => step.classList.add('active'));
            arrows.forEach(arrow => arrow.classList.add('active'));
        }
        
        animateWorkflow();
        
        // Handle resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const newIsMobile = window.innerWidth <= 768;
                if (newIsMobile) {
                    // Show all on mobile
                    steps.forEach(step => step.classList.add('active'));
                    arrows.forEach(arrow => arrow.classList.add('active'));
                } else {
                    // Restart animation on desktop - remove and re-add to restart
                    steps.forEach(step => {
                        step.classList.remove('active');
                        void step.offsetWidth; // Force reflow
                        step.classList.add('active');
                    });
                    arrows.forEach(arrow => {
                        arrow.classList.remove('active');
                        void arrow.offsetWidth; // Force reflow
                        arrow.classList.add('active');
                    });
                }
            }, 250);
        });
    });
</script>
{% endblock %}
